---
import ArticleCard from '../../components/ArticleCard.astro';
import MainLayout from './../../layouts/MainLayout.astro'
import Pagination from '../../components/Pagination.astro';
import SearchForm from '../../components/SearchForm.astro';
import { ARTICLES_PER_PAGE } from '../../constants';
import './../../styles/index.css'

import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

const currentPage: number | null = +Astro.url.searchParams.get('page')! || 1;

const allBlogArticles: CollectionEntry<'blog'>[] = (await getCollection('blog')).sort((a:CollectionEntry<'blog'>,b:CollectionEntry<'blog'>)=> b.data.pubDate.valueOf()- a.data.pubDate.valueOf())

const totalPages: number = Math.ceil(allBlogArticles.length / ARTICLES_PER_PAGE)

const articlesForPage: CollectionEntry<'blog'>[] = allBlogArticles.slice((currentPage-1)*ARTICLES_PER_PAGE,currentPage*ARTICLES_PER_PAGE)
---
<MainLayout title="Blog">
	
    <div class="articles-container">
        <div class="title">
            <h1>Recueil de po√©sies spirituelles </br>et amoureuses</h1>
        </div>
        <div class="search-container">
			<SearchForm />
		</div>     
        <div class="articles-cards-container">
            {articlesForPage.map((article)=>(
                <ArticleCard article={article}/>
            ))}
        </div>
        <Pagination 
            currentPage={currentPage} 
            disablePrevious={currentPage === 1} 
            disableNext={currentPage === totalPages}
        />
    </div>
</MainLayout>